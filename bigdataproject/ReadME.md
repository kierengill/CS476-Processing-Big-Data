# Directory Structure

* [ana_code/](./bigdataproject/ana_code)
  * [mapreduce_ems/](./bigdataproject/ana_code/mapreduce_ems)
    * [Analytics.class](./bigdataproject/ana_code/mapreduce_ems/Analytics.class)
    * [Analytics.java](./bigdataproject/ana_code/mapreduce_ems/Analytics.java)
    * [AnalyticsMapper.class](./bigdataproject/ana_code/mapreduce_ems/AnalyticsMapper.class)
    * [AnalyticsMapper.java](./bigdataproject/ana_code/mapreduce_ems/AnalyticsMapper.java)
    * [AnalyticsReducer.class](./bigdataproject/ana_code/mapreduce_ems/AnalyticsReducer.class)
    * [AnalyticsReducer.java](./bigdataproject/ana_code/mapreduce_ems/AnalyticsReducer.java)
    * [analytics.jar](./bigdataproject/ana_code/mapreduce_ems/analytics.jar)
  * [mapreduce_fire/](./bigdataproject/ana_code/mapreduce_fire)
    * [Analytics.class](./bigdataproject/ana_code/mapreduce_fire/Analytics.class)
    * [Analytics.java](./bigdataproject/ana_code/mapreduce_fire/Analytics.java)
    * [AnalyticsMapper.class](./bigdataproject/ana_code/mapreduce_fire/AnalyticsMapper.class)
    * [AnalyticsMapper.java](./bigdataproject/ana_code/mapreduce_fire/AnalyticsMapper.java)
    * [AnalyticsReducer.class](./bigdataproject/ana_code/mapreduce_fire/AnalyticsReducer.class)
    * [AnalyticsReducer.java](./bigdataproject/ana_code/mapreduce_fire/AnalyticsReducer.java)
    * [analytics.jar](./bigdataproject/ana_code/mapreduce_fire/analytics.jar)
  * [mapreduce_outputs/](./bigdataproject/ana_code/mapreduce_outputs)
    * [project_analytics_final_ems.csv](./bigdataproject/ana_code/mapreduce_outputs/project_analytics_final_ems.csv)
    * [project_analytics_final_fire.csv](./bigdataproject/ana_code/mapreduce_outputs/project_analytics_final_fire.csv)
* [data_ingest/](./bigdataproject/data_ingest)
  * [dataIngest.txt](./bigdataproject/data_ingest/dataIngest.txt)
* [etl_code/](./bigdataproject/etl_code)
  * [bbz2005/](./bigdataproject/etl_code/bbz2005)
    * [Clean.class](./bigdataproject/etl_code/bbz2005/Clean.class)
    * [Clean.jar](./bigdataproject/etl_code/bbz2005/Clean.jar)
    * [Clean.java](./bigdataproject/etl_code/bbz2005/Clean.java)
    * [CleanMapper.class](./bigdataproject/etl_code/bbz2005/CleanMapper.class)
    * [CleanMapper.java](./bigdataproject/etl_code/bbz2005/CleanMapper.java)
    * [CleanReducer.class](./bigdataproject/etl_code/bbz2005/CleanReducer.class)
    * [CleanReducer.java](./bigdataproject/etl_code/bbz2005/CleanReducer.java)
  * [ksg7699/](./bigdataproject/etl_code/ksg7699)
    * [Clean.class](./bigdataproject/etl_code/ksg7699/Clean.class)
    * [Clean.java](./bigdataproject/etl_code/ksg7699/Clean.java)
    * [CleanMapper.class](./bigdataproject/etl_code/ksg7699/CleanMapper.class)
    * [CleanMapper.java](./bigdataproject/etl_code/ksg7699/CleanMapper.java)
    * [CleanReducer.class](./bigdataproject/etl_code/ksg7699/CleanReducer.class)
    * [CleanReducer.java](./bigdataproject/etl_code/ksg7699/CleanReducer.java)
    * [clean.jar](./bigdataproject/etl_code/ksg7699/clean.jar)
* [profiling_code/](./bigdataproject/profiling_code)
  * [bbz2005/](./bigdataproject/profiling_code/bbz2005)
    * [countRecs_1/](./bigdataproject/profiling_code/bbz2005/countRecs_1)
      * [CountRecs.class](./bigdataproject/profiling_code/bbz2005/countRecs_1/CountRecs.class)
      * [CountRecs.jar](./bigdataproject/profiling_code/bbz2005/countRecs_1/CountRecs.jar)
      * [CountRecs.java](./bigdataproject/profiling_code/bbz2005/countRecs_1/CountRecs.java)
      * [CountRecsMapper.class](./bigdataproject/profiling_code/bbz2005/countRecs_1/CountRecsMapper.class)
      * [CountRecsMapper.java](./bigdataproject/profiling_code/bbz2005/countRecs_1/CountRecsMapper.java)
      * [CountRecsReducer.class](./bigdataproject/profiling_code/bbz2005/countRecs_1/CountRecsReducer.class)
      * [CountRecsReducer.java](./bigdataproject/profiling_code/bbz2005/countRecs_1/CountRecsReducer.java)
    * [countRecs_2/](./bigdataproject/profiling_code/bbz2005/countRecs_2)
      * [CountRecs.class](./bigdataproject/profiling_code/bbz2005/countRecs_2/CountRecs.class)
      * [CountRecs.jar](./bigdataproject/profiling_code/bbz2005/countRecs_2/CountRecs.jar)
      * [CountRecs.java](./bigdataproject/profiling_code/bbz2005/countRecs_2/CountRecs.java)
      * [CountRecsMapper.class](./bigdataproject/profiling_code/bbz2005/countRecs_2/CountRecsMapper.class)
      * [CountRecsMapper.java](./bigdataproject/profiling_code/bbz2005/countRecs_2/CountRecsMapper.java)
      * [CountRecsReducer.class](./bigdataproject/profiling_code/bbz2005/countRecs_2/CountRecsReducer.class)
      * [CountRecsReducer.java](./bigdataproject/profiling_code/bbz2005/countRecs_2/CountRecsReducer.java)
  * [ksg7699/](./bigdataproject/profiling_code/ksg7699)
    * [countRecs_1/](./bigdataproject/profiling_code/ksg7699/countRecs_1)
      * [CountRecs.class](./bigdataproject/profiling_code/ksg7699/countRecs_1/CountRecs.class)
      * [CountRecs.java](./bigdataproject/profiling_code/ksg7699/countRecs_1/CountRecs.java)
      * [CountRecsMapper.class](./bigdataproject/profiling_code/ksg7699/countRecs_1/CountRecsMapper.class)
      * [CountRecsMapper.java](./bigdataproject/profiling_code/ksg7699/countRecs_1/CountRecsMapper.java)
      * [CountRecsReducer.class](./bigdataproject/profiling_code/ksg7699/countRecs_1/CountRecsReducer.class)
      * [CountRecsReducer.java](./bigdataproject/profiling_code/ksg7699/countRecs_1/CountRecsReducer.java)
      * [countRecs.jar](./bigdataproject/profiling_code/ksg7699/countRecs_1/countRecs.jar)
    * [countRecs_2/](./bigdataproject/profiling_code/ksg7699/countRecs_2)
      * [CountRecs.class](./bigdataproject/profiling_code/ksg7699/countRecs_2/CountRecs.class)
      * [CountRecs.java](./bigdataproject/profiling_code/ksg7699/countRecs_2/CountRecs.java)
      * [CountRecsMapper.class](./bigdataproject/profiling_code/ksg7699/countRecs_2/CountRecsMapper.class)
      * [CountRecsMapper.java](./bigdataproject/profiling_code/ksg7699/countRecs_2/CountRecsMapper.java)
      * [CountRecsReducer.class](./bigdataproject/profiling_code/ksg7699/countRecs_2/CountRecsReducer.class)
      * [CountRecsReducer.java](./bigdataproject/profiling_code/ksg7699/countRecs_2/CountRecsReducer.java)
      * [countRecs.jar](./bigdataproject/profiling_code/ksg7699/countRecs_2/countRecs.jar)
* [screenshots/](./bigdataproject/screenshots)
  * [Analytics/](./bigdataproject/screenshots/Analytics)
    * [EMS Analytics MR 1.png](./bigdataproject/screenshots/Analytics/EMS Analytics MR 1.png)
    * [EMS Analytics MR 2.png](./bigdataproject/screenshots/Analytics/EMS Analytics MR 2.png)
    * [FIRE Analytics MR.png](./bigdataproject/screenshots/Analytics/FIRE Analytics MR.png)
    * [Hive Tables 1.png](./bigdataproject/screenshots/Analytics/Hive Tables 1.png)
    * [Hive Tables 2.png](./bigdataproject/screenshots/Analytics/Hive Tables 2.png)
    * [Hive Tables 3.png](./bigdataproject/screenshots/Analytics/Hive Tables 3.png)
  * [Other Screenshots/](./bigdataproject/screenshots/Other Screenshots)
    * [Count Cleaned EMS 1.png](./bigdataproject/screenshots/Other Screenshots/Count Cleaned EMS 1.png)
    * [Count Cleaned EMS 2.png](./bigdataproject/screenshots/Other Screenshots/Count Cleaned EMS 2.png)
    * [Count Cleaned Fire Output.png](./bigdataproject/screenshots/Other Screenshots/Count Cleaned Fire Output.png)
    * [Count Cleaned Fire.png](./bigdataproject/screenshots/Other Screenshots/Count Cleaned Fire.png)
    * [Count Original EMS 1.png](./bigdataproject/screenshots/Other Screenshots/Count Original EMS 1.png)
    * [Count Original EMS 2.png](./bigdataproject/screenshots/Other Screenshots/Count Original EMS 2.png)
    * [Count Original Fire 1.png](./bigdataproject/screenshots/Other Screenshots/Count Original Fire 1.png)
    * [Count Original Fire 2.png](./bigdataproject/screenshots/Other Screenshots/Count Original Fire 2.png)
    * [Count Original Fire Output.png](./bigdataproject/screenshots/Other Screenshots/Count Original Fire Output.png)
    * [EMS Cleaning MR 1.png](./bigdataproject/screenshots/Other Screenshots/EMS Cleaning MR 1.png)
    * [EMS Cleaning MR 2.png](./bigdataproject/screenshots/Other Screenshots/EMS Cleaning MR 2.png)
    * [EMS Cleaning Output .png](./bigdataproject/screenshots/Other Screenshots/EMS Cleaning Output .png)
    * [EMS Data Access.png](./bigdataproject/screenshots/Other Screenshots/EMS Data Access.png)
    * [EMS Data Ingest.png](./bigdataproject/screenshots/Other Screenshots/EMS Data Ingest.png)
    * [Fire Cleaning Output 1.png](./bigdataproject/screenshots/Other Screenshots/Fire Cleaning Output 1.png)
    * [Fire Cleaning Output 2.png](./bigdataproject/screenshots/Other Screenshots/Fire Cleaning Output 2.png)
    * [Fire Data Access.png](./bigdataproject/screenshots/Other Screenshots/Fire Data Access.png)
    * [Fire Data Ingest.png](./bigdataproject/screenshots/Other Screenshots/Fire Data Ingest.png)
* [test_code/](./bigdataproject/test_code)
  * [ML Code.ipynb](./bigdataproject/test_code/ML Code.ipynb)
* [ReadME.md](./bigdataproject/ReadME.md)

# How to Build and Run Code
First, we need to ingest the data! Head over to data_ingest and open the dataIngest.txt file, which contains the instructions on how to ingest the code. If you don't feel like opening the file, here's the steps for you right here:

# Data Ingestion

Step 1: Go to https://data.cityofnewyork.us/Public-Safety/EMS-Incident-Dispatch-Data/76xm-jjuj

Step 2: Export data as CSV, rename file to ems.csv

Step 3: Run the following command on terminal - this is how you scp files: 
scp <pathname_of_downloaded_file> <netID>@peel.hpc.nyu.edu:/home/<netID>

Step 4: Go to https://data.cityofnewyork.us/Public-Safety/Fire-Incident-Dispatch-Data/8m42-w767

Step 5: Export data as CSV, rename file to fire.csv

Step 6: Run the following command on terminal: 
scp <pathname_of_downloaded_file> <netID>@peel.hpc.nyu.edu:/home/<netID>

Step 7: Make a directory for these input files: hdfs dfs -mkdir input

Step 8: Put files in this directory using:
hdfs dfs -put fire.csv input
hdfs dfs -put ems.csv input

Step 9: Well done - you're done with data ingestion! Time to move on to data profiling and cleaning!

# Data Profiling (Part 1)
Step 1: Access the code for profiling the original EMS data in profiling_code/bbz2005/countRecs_1.

Step 2: scp all the .java files into Peel

Step 3: Run a MapReduce (MR) job using the following commands:

javac -classpath 'yarn classpath' -d . CountRecsMapper.java
javac -classpath 'yarn classpath' -d . CountRecsReducer.java
javac -classpath 'yarn classpath':. -d . CountRecs.java
jar -cvf CountRecs.jar *.class
hadoop jar CountRecs.jar CountRecs ems.csv project/output1

Step 4: Access output using this:

hdfs dfs -cat cleaned output1/part-r-00000

It should output the number of lines.

Next, let's profile the original Fire dataset.

Step 1: Access the code for profiling the original EMS data in profiling_code/ksg7699/countRecs_1.

Step 2: scp all the .java files into Peel

Step 3: Run a MapReduce (MR) job using the following commands:

javac -classpath 'yarn classpath' -d . CountRecsMapper.java
javac -classpath 'yarn classpath' -d . CountRecsReducer.java
javac -classpath 'yarn classpath':. -d . CountRecs.java
jar -cvf CountRecs.jar *.class
hadoop jar CountRecs.jar CountRecs ems.csv project/output2

Step 4: Access output using this:

hdfs dfs -cat cleaned output2/part-r-00000

It should output the number of lines.

# Data Cleaning
Step 1: Access the code for profiling the original EMS data in etl_code/bbz2005

Step 2: scp all the .java files into Peel

Step 3: Run a MapReduce (MR) job using the following commands:

javac -classpath 'yarn classpath' -d . CleanMapper.java
javac -classpath 'yarn classpath' -d . CleanReducer.java
javac -classpath 'yarn classpath':. -d . Clean.java
jar -cvf Clean.jar *.class
hadoop jar Clean.jar Clean ems.csv project/output3

Step 4: If you want, access output using this:

hdfs dfs -cat cleaned output3/part-r-00000

This is the location of your cleaned EMS dataset!

Next, let's clean the Fire dataset!

Step 1: Access the code for profiling the original Fire data in etl_code/ksg7699

Step 2: scp all the .java files into Peel

Step 3: Run a MapReduce (MR) job using the following commands:

javac -classpath 'yarn classpath' -d . CleanMapper.java
javac -classpath 'yarn classpath' -d . CleanReducer.java
javac -classpath 'yarn classpath':. -d . Clean.java
jar -cvf Clean.jar *.class
hadoop jar Clean.jar Clean ems.csv project/output4

Step 4: If you want, access output using this:

hdfs dfs -cat cleaned output4/part-r-00000

This is the location of your cleaned Fire dataset!

Now that we're done cleaning, let's profile the data again to see how many rows we have left!

# Data Profiling (Part 2)
Step 1: Access the code for profiling the original EMS data in profiling_code/bbz2005/countRecs_2.

Step 2: scp all the .java files into Peel

Step 3: Run a MapReduce (MR) job using the following commands:

javac -classpath 'yarn classpath' -d . CountRecsMapper.java
javac -classpath 'yarn classpath' -d . CountRecsReducer.java
javac -classpath 'yarn classpath':. -d . CountRecs.java
jar -cvf CountRecs.jar *.class
hadoop jar CountRecs.jar CountRecs ems.csv project/output5

Step 4: Access output using this:

hdfs dfs -cat cleaned output5/part-r-00000

It should output the number of lines.

Next, let's profile the original Fire dataset.

Step 1: Access the code for profiling the original EMS data in profiling_code/ksg7699/countRecs_2.

Step 2: scp all the .java files into Peel

Step 3: Run a MapReduce (MR) job using the following commands:

javac -classpath 'yarn classpath' -d . CountRecsMapper.java
javac -classpath 'yarn classpath' -d . CountRecsReducer.java
javac -classpath 'yarn classpath':. -d . CountRecs.java
jar -cvf CountRecs.jar *.class
hadoop jar CountRecs.jar CountRecs ems.csv project/output6

Step 4: Access output using this:

hdfs dfs -cat cleaned output6/part-r-00000

It should output the number of lines.

# Data Analysis
Step 1: Access the code for analyzing the original EMS data in ana_code/mapreduce_ems

Step 2: scp all the .java files into Peel

Step 3: Run a MapReduce (MR) job using the following commands:

javac -classpath 'yarn classpath' -d . AnalyticsMapper.java
javac -classpath 'yarn classpath' -d . AnalyticsReducer.java
javac -classpath 'yarn classpath':. -d . Analytics.java
jar -cvf CountRecs.jar *.class
hadoop jar CountRecs.jar CountRecs ems.csv project/output7

Step 4: Access output using this:

hdfs dfs -cat cleaned output7/part-r-00000

Step 5: Create a csv file from the output:

hdfs dfs -cat output7/part-r-00000 » /home/<netID>/analyzedEMS.csv

Now, let's do the same with the Fire dataset!

Step 1: Access the code for analyzing the original EMS data in ana_code/mapreduce_fire

Step 2: scp all the .java files into Peel

Step 3: Run a MapReduce (MR) job using the following commands:

javac -classpath 'yarn classpath' -d . AnalyticsMapper.java
javac -classpath 'yarn classpath' -d . AnalyticsReducer.java
javac -classpath 'yarn classpath':. -d . Analytics.java
jar -cvf CountRecs.jar *.class
hadoop jar CountRecs.jar CountRecs ems.csv project/output8

Step 4: Access output using this:

hdfs dfs -cat cleaned output8/part-r-00000

Step 5: Create a csv file from the output:

hdfs dfs -cat output8/part-r-00000 » /home/<netID>/analyzedFire.csv

Now, let's use these csv's in Hive!

Commands for hive:

beeline
!connect jdbc:hive2://hm-1.hpc.nyu.edu:10000/
<netID>
<password>
use <netID>;
CREATE EXTERNAL TABLE ems_table (borough STRING, severity DOUBLE, incidentResponse DOUBLE, count DOUBLE) ROW FORMAT DELIMITED FIELDS TERMINATED BY ',' STORED AS TEXTFILE LOCATION '/user/<netID>/ems';
CREATE EXTERNAL TABLE fire_table (borough STRING, fire_response  DOUBLE, engine DOUBLE, fire_count DOUBLE) ROW FORMAT DELIMITED FIELDS TERMINATED BY ',' STORED AS TEXTFILE LOCATION '/user/<netID>/fire';
load data inpath 'hdfs://horton.hpc.nyu.edu:8020/<path_to_fire_csv>' overwrite into table fire_table;
load data inpath 'hdfs://horton.hpc.nyu.edu:8020/<path_to_ems_csv>' overwrite into table ems_table;
select * from ems_table;
select * from fire_table;
select ems_table.*, fire_table.* from ems_table inner join fire_table on ems_table.borough = fire_table.borough;

Access to hive tables screenshots are in screenshots/Analytics

Thank you!

Lots of love,
Bradley and Kieren :)
bbz2005, ksg7699